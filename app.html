<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c5aa0">
    <title>Soccer in a Box - Ecosistema Calcistico</title>
    <link rel="manifest" href="manifest.json">
    
    <!-- JavaScript at the top to ensure it loads -->
    <script>
        console.log('üöÄ JavaScript loading...');
        
        // Global state
        let currentMode = null;
        let userProfile = {
            name: '',
            favoriteTeam: '',
            emotionsShared: 0,
            pollsVoted: 0
        };

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = message.replace(/\n/g, '<br>');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 20px;
                right: 20px;
                background: ${type === 'error' ? '#f44336' : type === 'success' ? '#4CAF50' : '#2196F3'};
                color: white;
                padding: 1rem;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                z-index: 1000;
                animation: slideDown 0.3s ease;
                text-align: center;
                font-size: 0.9rem;
                line-height: 1.4;
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // Mode selection - MAIN FUNCTION
        function selectMode(mode) {
            console.log('üéØ Selecting mode:', mode);
            currentMode = mode;
            
            try {
                // Hide all screens
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                // Show selected screen
                const targetScreen = document.getElementById(mode + '-screen');
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    console.log('‚úÖ Screen switched to:', mode);
                    
                    if (mode === 'community') {
                        setupCommunity();
                    }
                    
                    // Save preference
                    localStorage.setItem('soccerbox_mode', mode);
                } else {
                    console.error('‚ùå Screen not found:', mode + '-screen');
                }
            } catch (error) {
                console.error('‚ùå Error in selectMode:', error);
                showNotification('Errore nel cambio modalit√†', 'error');
            }
        }

        // Switch between modes
        function switchMode() {
            const newMode = currentMode === 'coach' ? 'community' : 'coach';
            console.log('üîÑ Switching to:', newMode);
            selectMode(newMode);
        }

        // Setup community
        function setupCommunity() {
            console.log('üéâ Setting up community...');
            loadData();
            if (userProfile.name) {
                const profileSetup = document.getElementById('profile-setup');
                if (profileSetup) {
                    profileSetup.style.display = 'none';
                }
            }
            updateStats();
        }

        // Load saved data
        function loadData() {
            try {
                const saved = localStorage.getItem('soccerbox_data');
                if (saved) {
                    userProfile = { ...userProfile, ...JSON.parse(saved) };
                }
            } catch (e) {
                console.warn('Failed to load data');
            }
        }

        // Save data
        function saveData() {
            try {
                localStorage.setItem('soccerbox_data', JSON.stringify(userProfile));
            } catch (e) {
                console.warn('Failed to save data');
            }
        }

        // Save profile
        function saveProfile() {
            console.log('üíæ Saving profile...');
            const nameInput = document.getElementById('user-name');
            const teamInput = document.getElementById('favorite-team');
            
            if (!nameInput || !teamInput) {
                showNotification('Errore: campi non trovati', 'error');
                return;
            }
            
            const name = nameInput.value.trim();
            const team = teamInput.value.trim();
            
            if (!name || !team) {
                showNotification('Compila tutti i campi', 'error');
                return;
            }
            
            userProfile.name = name;
            userProfile.favoriteTeam = team;
            saveData();
            
            const profileSetup = document.getElementById('profile-setup');
            if (profileSetup) {
                profileSetup.style.display = 'none';
            }
            
            showNotification(`Benvenuto ${name}! üéâ<br>Ora puoi usare tutte le funzioni!`);
        }

        // Share emotion
        function shareEmotion() {
            console.log('üòç Sharing emotion...');
            const emotions = ['üòç', 'üî•', '‚ö°', 'üí™', 'üéØ', 'üëè', '‚ù§Ô∏è', 'üöÄ', '‚≠ê', 'üéâ'];
            const emotion = emotions[Math.floor(Math.random() * emotions.length)];
            
            userProfile.emotionsShared++;
            saveData();
            updateStats();
            
            showNotification(`Hai condiviso: ${emotion}<br><br>La tua emozione √® stata inviata alla community!`);
        }

        // Vote poll
        function votePoll() {
            console.log('üó≥Ô∏è Voting poll...');
            const polls = [
                {
                    question: "Quale formazione per la prossima partita?",
                    choice: "4-3-3 Offensivo"
                },
                {
                    question: "Chi dovrebbe essere il capitano?", 
                    choice: "Marco Rossi"
                },
                {
                    question: "Miglior momento per allenarsi?",
                    choice: "Pomeriggio"
                }
            ];
            
            const poll = polls[Math.floor(Math.random() * polls.length)];
            userProfile.pollsVoted++;
            saveData();
            updateStats();
            
            showNotification(`Sondaggio: ${poll.question}<br><br>‚úÖ Hai votato: ${poll.choice}<br><br>Voto registrato con successo!`);
        }

        // View stats
        function viewStats() {
            console.log('üìà Viewing stats...');
            const stats = `üìä Statistiche Dettagliate:<br><br>üèà Match in corso:<br>‚Ä¢ Possesso palla: 62%<br>‚Ä¢ Tiri in porta: 8<br>‚Ä¢ Precisione passaggi: 87%<br>‚Ä¢ Intensit√†: Alta<br><br>üòç La tua attivit√†:<br>‚Ä¢ Emozioni condivise: ${userProfile.emotionsShared}<br>‚Ä¢ Sondaggi votati: ${userProfile.pollsVoted}<br><br>üåç Community globale:<br>‚Ä¢ Squadre attive: 3,247<br>‚Ä¢ Tifosi online: 12,483<br>‚Ä¢ Paesi connessi: 67`;

            showNotification(stats, 'info');
        }

        // Send support
        function sendSupport() {
            console.log('üíå Sending support...');
            const messages = [
                "Forza ragazzi! Siamo con voi! üí™",
                "Crediamo in voi, vinceremo insieme! üèÜ", 
                "Grande squadra, grande cuore! ‚ù§Ô∏è",
                "Il nostro supporto non vi manca mai! üëè",
                "Avanti cos√¨, siete fantastici! ‚ö°"
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            showNotification(`üíå Messaggio inviato alla squadra:<br><br>"${message}"<br><br>Lo staff tecnico ricever√† il tuo supporto!`);
        }

        // Refresh feed
        function refreshFeed() {
            console.log('üîÑ Refreshing feed...');
            const feeds = [
                {
                    source: "‚öΩ Match Live",
                    time: "ora",
                    content: "<strong>85'</strong> - Parata incredibile del portiere!",
                    reactions: "üî• 23 reazioni"
                },
                {
                    source: "üòç Community", 
                    time: "2 min fa",
                    content: "Anna ha condiviso: üöÄ",
                    reactions: "üëè 12 reazioni"
                },
                {
                    source: "üó≥Ô∏è Sondaggi",
                    time: "5 min fa", 
                    content: "Nuovo sondaggio: Chi √® il migliore oggi?",
                    reactions: "üìä 45 voti"
                },
                {
                    source: "üåç Network",
                    time: "8 min fa",
                    content: "üèÜ Record giornaliero: 5,000 squadre attive!",
                    reactions: "‚≠ê 156 reazioni"
                }
            ];
            
            const feedContainer = document.getElementById('live-feed');
            if (feedContainer) {
                feedContainer.innerHTML = feeds.map(feed => `
                    <div class="feed-item">
                        <div class="feed-header">
                            <span class="feed-source">${feed.source}</span>
                            <span class="feed-time">${feed.time}</span>
                        </div>
                        <div class="feed-content">${feed.content}</div>
                        <div class="feed-reactions">${feed.reactions}</div>
                    </div>
                `).join('');
            }
            
            showNotification('üì± Feed aggiornato con le ultime attivit√†!');
        }

        // Join global network
        function joinGlobalNetwork() {
            console.log('üåç Joining global network...');
            showNotification('üåç Benvenuto nella Rete Globale!<br><br>Ora sei connesso con:<br>‚Ä¢ 3,247 squadre attive<br>‚Ä¢ 67 paesi nel mondo<br>‚Ä¢ 12,483 tifosi online<br><br>Potrai partecipare a tornei globali!');
        }

        // Coach functions
        function startMatchSetup() {
            console.log('üèüÔ∏è Starting match setup...');
            showNotification('üèüÔ∏è Avvio setup match...<br><br>Funzionalit√† disponibile nella versione completa Coach.');
        }

        // Update stats display
        function updateStats() {
            const emotionsElement = document.getElementById('user-emotions');
            if (emotionsElement) {
                emotionsElement.textContent = userProfile.emotionsShared;
            }
        }

        // Initialize app when page loads
        function initApp() {
            console.log('üöÄ Initializing Soccer in a Box...');
            
            try {
                loadData();
                
                // Check for returning user
                const savedMode = localStorage.getItem('soccerbox_mode');
                if (savedMode) {
                    console.log('üì± Returning user, loading mode:', savedMode);
                    selectMode(savedMode);
                }
                
                console.log('‚úÖ App initialized successfully');
            } catch (error) {
                console.error('‚ùå App initialization failed:', error);
            }
        }

        // Wait for page to load, then initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
        
        console.log('‚úÖ JavaScript loaded successfully');
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
        }

        .screen.active {
            display: block;
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            color: white;
        }

        .logo {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 2rem;
            max-width: 400px;
        }

        .mode-selector {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 400px;
        }

        .mode-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }

        .mode-card:active {
            transform: scale(0.95);
            background: rgba(255,255,255,0.25);
        }

        .mode-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .mode-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .mode-description {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* App Header */
        .app-header {
            background: white;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2c5aa0;
        }

        .mode-switcher {
            background: #2c5aa0;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Container */
        .app-container {
            padding: 1rem;
        }

        /* Cards */
        .feature-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .feature-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #2c5aa0;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c5aa0;
        }

        .stat-label {
            color: #666;
            margin-top: 0.3rem;
            font-size: 0.8rem;
        }

        /* Buttons */
        .btn {
            background: #2c5aa0;
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            width: 100%;
            margin: 0.5rem 0;
            transition: all 0.2s ease;
        }

        .btn:active {
            transform: scale(0.95);
            background: #4CAF50;
        }

        .btn-secondary {
            background: #FF9800;
        }

        /* Community Actions */
        .community-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .action-btn {
            background: linear-gradient(135deg, #2c5aa0, #4CAF50);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s ease;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        /* Feed */
        .feed-container {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .feed-item {
            background: #f8f9fa;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            border-left: 3px solid #FF9800;
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .feed-source {
            font-weight: bold;
            color: #2c5aa0;
        }

        .feed-time {
            font-size: 0.8rem;
            color: #666;
        }

        .feed-reactions {
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #666;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: slideDown 0.3s ease;
        }

        .notification.error {
            background: #f44336;
        }

        .notification.info {
            background: #2196F3;
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: slideDown 0.3s ease;
            text-align: center;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .notification.error {
            background: #f44336;
        }

        .notification.info {
            background: #2196F3;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-100%); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form */
        .form-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        /* Profile form */
        .profile-form {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcome-screen" class="screen welcome-screen active">
        <div class="logo">‚öΩ</div>
        <h1 class="welcome-title">Soccer in a Box</h1>
        <p class="welcome-subtitle">
            L'ecosistema completo per l'analisi calcistica.<br>
            Scegli la tua modalit√† per iniziare.
        </p>
        
        <div class="mode-selector">
            <div class="mode-card" onclick="selectMode('coach')">
                <div class="mode-icon">üìä</div>
 
